{"ast":null,"code":"var crypto = require('crypto');\n\nvar self = module.exports;\nconst RANDOM_BATCH_SIZE = 256;\nvar randomIndex;\nvar randomBytes;\n\nvar getNextRandomValue = function () {\n  if (randomIndex === undefined || randomIndex >= randomBytes.length) {\n    randomIndex = 0;\n    randomBytes = crypto.randomBytes(RANDOM_BATCH_SIZE);\n  }\n\n  var result = randomBytes[randomIndex];\n  randomIndex += 1;\n  return result;\n}; // Generates a random number\n\n\nvar randomNumber = function (max) {\n  // gives a number between 0 (inclusive) and max (exclusive)\n  var rand = getNextRandomValue();\n\n  while (rand >= 256 - 256 % max) {\n    rand = getNextRandomValue();\n  }\n\n  return rand % max;\n}; // Possible combinations\n\n\nvar lowercase = 'abcdefghijklmnopqrstuvwxyz',\n    uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',\n    numbers = '0123456789',\n    symbols = '!@#$%^&*()+_-=}{[]|:;\"/?.><,`~',\n    similarCharacters = /[ilLI|`oO0]/g,\n    strictRules = [{\n  name: 'lowercase',\n  rule: /[a-z]/\n}, {\n  name: 'uppercase',\n  rule: /[A-Z]/\n}, {\n  name: 'numbers',\n  rule: /[0-9]/\n}, {\n  name: 'symbols',\n  rule: /[!@#$%^&*()+_\\-=}{[\\]|:;\"/?.><,`~]/\n}];\n\nvar generate = function (options, pool) {\n  var password = '',\n      optionsLength = options.length,\n      poolLength = pool.length;\n\n  for (var i = 0; i < optionsLength; i++) {\n    password += pool[randomNumber(poolLength)];\n  }\n\n  if (options.strict) {\n    // Iterate over each rule, checking to see if the password works.\n    var fitsRules = strictRules.every(function (rule) {\n      // If the option is not checked, ignore it.\n      if (options[rule.name] == false) return true; // Run the regex on the password and return whether\n      // or not it matches.\n\n      return rule.rule.test(password);\n    }); // If it doesn't fit the rules, generate a new one (recursion).\n\n    if (!fitsRules) return generate(options, pool);\n  }\n\n  return password;\n}; // Generate a random password.\n\n\nself.generate = function (options) {\n  // Set defaults.\n  options = options || {};\n  if (!Object.prototype.hasOwnProperty.call(options, 'length')) options.length = 10;\n  if (!Object.prototype.hasOwnProperty.call(options, 'numbers')) options.numbers = false;\n  if (!Object.prototype.hasOwnProperty.call(options, 'symbols')) options.symbols = false;\n  if (!Object.prototype.hasOwnProperty.call(options, 'exclude')) options.exclude = '';\n  if (!Object.prototype.hasOwnProperty.call(options, 'uppercase')) options.uppercase = true;\n  if (!Object.prototype.hasOwnProperty.call(options, 'lowercase')) options.lowercase = true;\n  if (!Object.prototype.hasOwnProperty.call(options, 'excludeSimilarCharacters')) options.excludeSimilarCharacters = false;\n  if (!Object.prototype.hasOwnProperty.call(options, 'strict')) options.strict = false;\n\n  if (options.strict) {\n    var minStrictLength = 1 + (options.numbers ? 1 : 0) + (options.symbols ? 1 : 0) + (options.uppercase ? 1 : 0);\n\n    if (minStrictLength > options.length) {\n      throw new TypeError('Length must correlate with strict guidelines');\n    }\n  } // Generate character pool\n\n\n  var pool = ''; // lowercase\n\n  if (options.lowercase) {\n    pool += lowercase;\n  } // uppercase\n\n\n  if (options.uppercase) {\n    pool += uppercase;\n  } // numbers\n\n\n  if (options.numbers) {\n    pool += numbers;\n  } // symbols\n\n\n  if (options.symbols) {\n    pool += symbols;\n  } // Throw error if pool is empty.\n\n\n  if (!pool) {\n    throw new TypeError('At least one rule for pools must be true');\n  } // similar characters\n\n\n  if (options.excludeSimilarCharacters) {\n    pool = pool.replace(similarCharacters, '');\n  } // excludes characters from the pool\n\n\n  var i = options.exclude.length;\n\n  while (i--) {\n    pool = pool.replace(options.exclude[i], '');\n  }\n\n  var password = generate(options, pool);\n  return password;\n}; // Generates multiple passwords at once with the same options.\n\n\nself.generateMultiple = function (amount, options) {\n  var passwords = [];\n\n  for (var i = 0; i < amount; i++) {\n    passwords[i] = self.generate(options);\n  }\n\n  return passwords;\n};","map":null,"metadata":{},"sourceType":"script"}